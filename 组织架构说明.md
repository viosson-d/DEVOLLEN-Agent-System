# 🏢 DEVOLLEN 组织架构系统

## 概述

全新的**三层组织架构系统**实现了你提出的想法：
- **部门**：按技能和思维方式分组（项目管理、技术、数据）
- **职位**：每个部门内的不同岗位（初级、中级、高级、负责人）
- **Unit**：根据项目需求临时组建的工作小组

每个 **Unit 必须有专岗负责人**（Lead），可包含执行者（Executor）和支持者（Supporter）。

---

## 📊 系统架构

### 三层架构图

```
┌─────────────────────────────────────────────────────────┐
│              公司总部 (OrganizationSystem)              │
└─────────────────────────────────────────────────────────┘
                           ↓
        ┌──────────────────┼──────────────────┐
        ↓                  ↓                  ↓
    ┌─────────┐        ┌─────────┐        ┌─────────┐
    │ PM 部门  │        │技术部门  │        │ 数据部门  │
    ├─────────┤        ├─────────┤        ├─────────┤
    │ Senior  │        │ Senior  │        │ Senior  │
    │   PM    │        │   Dev   │        │Analyst  │
    │(2位)    │        │(5位)    │        │(3位)    │
    │         │        │         │        │         │
    │ PM Lead │        │  Tech   │        │  Data   │
    │(1位)    │        │  Lead   │        │  Lead   │
    │         │        │(1位)    │        │(1位)    │
    │ Junior  │        │ Junior  │        │ Junior  │
    │   PM    │        │   Dev   │        │Analyst  │
    │(2位)    │        │(5位)    │        │(3位)    │
    └────┬────┘        └────┬────┘        └────┬────┘
         │                  │                  │
         └──────────────────┼──────────────────┘
                           ↓
              📋 按需求组建临时 Unit
              ↓
        ┌──────────────────┼──────────────────┐
        ↓                  ↓                  ↓
    ┌──────────┐      ┌──────────┐      ┌──────────┐
    │ 项目 A   │      │ 项目 B   │      │ 项目 C   │
    │  Unit    │      │  Unit    │      │  Unit    │
    ├──────────┤      ├──────────┤      ├──────────┤
    │ Lead:    │      │ Lead:    │      │ Lead:    │
    │ PM-001   │      │ PM-002   │      │ Tech-001 │
    │          │      │          │      │          │
    │Executors:│      │Executors:│      │Executors:│
    │ Dev-001  │      │ Dev-002  │      │ Dev-003  │
    │Analyst-01│      │Analyst-02│      │Analyst-03│
    │          │      │          │      │          │
    │Supporters│      │Supporters│      │Supporters│
    │ (可选)   │      │ (可选)   │      │ (可选)   │
    └──────────┘      └──────────┘      └──────────┘
```

---

## 🎯 核心概念

### 1. 部门 (Department)

**用途**：按类型组织和管理 Agent

**属性**：
- `id`: 部门 ID
- `name`: 部门名称
- `type`: 部门类型（MANAGEMENT/TECHNOLOGY/DATA/PRODUCT/OPERATIONS）
- `lead_agent_id`: 部长
- `positions`: 职位集合

**预建部门**：
```
✓ 项目管理部 (PM Department)
✓ 技术部 (Technology Department)
✓ 数据部 (Data Department)
```

### 2. 职位 (Position)

**用途**：定义岗位的等级和要求

**预建职位**：
```
PM 部门:
  - Senior PM (高级项目经理, 最多 3 位)
  - PM Lead (项目负责人, 1 位)
  - Junior PM (初级项目经理, 最多 3 位)

技术部:
  - Senior Developer (高级开发, 最多 5 位)
  - Junior Developer (初级开发, 最多 5 位)
  - Tech Lead (技术负责人, 1 位)

数据部:
  - Senior Analyst (高级分析师, 最多 3 位)
  - Junior Analyst (初级分析师, 最多 3 位)
  - Data Lead (数据负责人, 1 位)
```

### 3. Unit (工作小组)

**用途**：根据项目需求临时组建的工作小组

**成员角色**：
- **Lead (负责人)**：1 位（必须），决策者和协调者
- **Executor (执行者)**：多位，具体执行工作
- **Supporter (支持者)**：多位（可选），提供辅助

**生命周期**：
```
FORMING (组建中) → ACTIVE (活跃) → PAUSED (暂停) 
                      ↓                 ↓
                  COMPLETED (完成) ← DISBANDED (解散)
```

---

## 💻 使用示例

### 示例 1: 创建部门

```python
from organization_system import setup_default_organization

org = setup_default_organization()
# 会自动创建 3 个部门
```

### 示例 2: 添加 Agent 到部门

```python
org.add_agent_to_department(
    dept_id="tech_dept",
    agent_id="dev_001",
    agent_name="王五 - 高级开发",
    position_name="Senior Developer",
    skills=["programming", "system_design", "python", "javascript"]
)
```

### 示例 3: 为项目 A 创建 Unit

```python
# 创建 Unit（指定负责人）
unit_a = org.create_unit_from_agents(
    unit_id="unit_project_a",
    name="项目 A - 电商平台开发",
    description="负责新电商平台的开发和上线",
    lead_agent_id="pm_001",      # 指定 PM 作为负责人
    project_id="project_a",
    priority=9  # 优先级 0-10
)

# 添加执行成员
org.add_executor_to_unit(
    unit_id="unit_project_a",
    agent_id="dev_001",
    responsibilities="核心开发，架构设计"
)

org.add_executor_to_unit(
    unit_id="unit_project_a",
    agent_id="analyst_001",
    responsibilities="性能分析，数据优化"
)

# 添加支持成员（可选）
org.add_supporter_to_unit(
    unit_id="unit_project_a",
    agent_id="dev_002",
    responsibilities="代码审查，测试支持"
)

# 激活 Unit
org.unit_manager.activate_unit("unit_project_a")
```

### 示例 4: 查找合适的 Agent

```python
# 查找具有特定技能的可用 Agent
agents = org.find_agents_for_unit(
    skills=["data_analysis"],
    available_only=True
)

# 查找高级开发者
from agent_department import PositionLevel, DepartmentType
agents = org.find_agents_for_unit(
    position_level=PositionLevel.SENIOR,
    dept_type=DepartmentType.TECHNOLOGY
)
```

### 示例 5: 查看 Agent 状态

```python
status = org.get_agent_status("dev_001")
print(f"Agent: {status['agent_name']}")
print(f"可用: {status['availability']}")
print(f"所属 Unit: {status['assigned_unit_id']}")
```

### 示例 6: 释放 Agent 和解散 Unit

```python
# 从 Unit 释放单个 Agent
org.release_agent_from_unit("dev_001")

# 解散 Unit（自动释放所有成员）
org.disband_unit("unit_project_a")
```

### 示例 7: 获取组织状态

```python
# 获取详细状态
status = org.get_organization_status()

# 生成报告
report = org.generate_report()
print(report)
```

---

## 📋 类和方法详解

### OrganizationSystem

**部门管理方法**：
- `create_department_with_positions()` - 创建部门
- `list_departments()` - 列出部门
- `add_agent_to_department()` - 添加 Agent

**Unit 管理方法**：
- `create_unit_from_agents()` - 创建 Unit
- `add_executor_to_unit()` - 添加执行者
- `add_supporter_to_unit()` - 添加支持者
- `release_agent_from_unit()` - 释放 Agent
- `disband_unit()` - 解散 Unit

**查询方法**：
- `find_agents_for_unit()` - 查找 Agent
- `get_unit_info()` - 获取 Unit 信息
- `get_agent_status()` - 获取 Agent 状态
- `get_organization_status()` - 获取组织整体状态
- `generate_report()` - 生成报告

---

## 🔄 Unit 生命周期工作流

```
1️⃣ 创建 Unit (FORMING)
   ├─ 指定 Lead（负责人）
   ├─ 添加 Executors（执行者）
   └─ 添加 Supporters（支持者，可选）

2️⃣ 激活 Unit (ACTIVE)
   ├─ 所有成员分配到 Unit
   ├─ 标记为不可用（availability=False）
   └─ Unit 开始工作

3️⃣ 运行中 (ACTIVE)
   ├─ 分配任务给 Unit
   ├─ 可暂停 (PAUSED)
   └─ 可恢复 (ACTIVE)

4️⃣ 完成或解散
   ├─ complete() → COMPLETED
   ├─ disband() → DISBANDED
   └─ 自动释放所有成员回部门
```

---

## ✅ 优势

| 特性 | 优势 |
|------|------|
| **部门化管理** | 按技能和思维方式分类，便于规范化管理 |
| **灵活组队** | 根据项目需求动态组建 Unit |
| **清晰责任** | 每个 Unit 有专岗负责人，责任明确 |
| **可扩展性** | 轻松添加新部门、新职位、新 Agent |
| **追踪完整** | 完整跟踪 Agent 的部门、职位、技能、状态 |
| **智能搜索** | 按技能、职位等级、部门类型查找 Agent |
| **自动释放** | Unit 完成时自动释放所有成员 |

---

## 📊 数据持久化

系统会自动将以下信息保存到本地文件：

```
/Users/viosson/departments_config.json  # 部门配置
/Users/viosson/units_config.json        # Unit 配置
```

系统重启时自动加载，无需重新配置。

---

## 🚀 快速开始

### 基础流程 (5 分钟)

```python
from organization_system import setup_default_organization

# 1. 初始化组织
org = setup_default_organization()

# 2. 添加 Agent
org.add_agent_to_department(
    "tech_dept", "dev_001", "开发者张三", 
    "Senior Developer", ["programming", "design"]
)

# 3. 创建 Unit
unit = org.create_unit_from_agents(
    "unit_proj_a", "项目 A", "新产品开发",
    "pm_001", priority=8
)

# 4. 组建团队
org.add_executor_to_unit("unit_proj_a", "dev_001", "开发")

# 5. 激活
org.unit_manager.activate_unit("unit_proj_a")

# 6. 完成后解散
org.disband_unit("unit_proj_a")
```

---

## 📝 完整工作示例

查看 `/Users/viosson/organization_examples.py` 了解 8 个完整的工作示例：

```bash
python3 organization_examples.py
```

输出包含：
- 部门创建和列表
- Agent 添加到部门
- Unit 创建和成员管理
- Agent 查找和筛选
- Unit 激活和管理
- 组织报告生成
- Agent 释放和 Unit 解散

---

## 💡 设计理念

你的建议→实现：

> "根据工作任务有不同的小组，但根据不同的技能和思维逻辑方式分为不同部门"

✅ **实现**：
- 部门 = 技能和思维方式（PM 部门、技术部、数据部）
- Unit = 项目任务（项目 A、项目 B...）
- 当项目需要时，从不同部门调取 Agent 组建 Unit

> "每个小组一定是有一个专岗负责人"

✅ **实现**：
- Unit.lead_member 必须存在（代码强制）
- Lead 不能被移除，必须有明确的负责人
- Lead 在决策和协调中起核心作用

---

## 🎓 学习路径

1. **理解架构**：阅读本文档的架构部分
2. **运行示例**：执行 `python3 organization_examples.py`
3. **手动创建**：按照"使用示例"创建自己的部门和 Unit
4. **集成应用**：将 OrganizationSystem 集成到你的应用

---

## 📞 常见问题

**Q: 如何修改 Unit 的成员？**
A: 使用 `release_agent_from_unit()` 释放后，再用 `add_executor_to_unit()` 添加新成员

**Q: 一个 Agent 可以在多个 Unit 中？**
A: 不可以。一个 Agent 同时只能属于一个 Unit（availability=False 时）

**Q: 如何添加新部门？**
A: 使用 `create_department_with_positions()`

**Q: Unit 的优先级有什么用？**
A: 可用于任务调度排序（0-10，数字越大优先级越高）

**Q: 如何扩展职位？**
A: 编辑 `PREDEFINED_POSITIONS` 或使用 Position 类创建新职位

---

**版本**：1.0.0 | **状态**：✅ 生产就绪 | **最后更新**：2025-11-21
